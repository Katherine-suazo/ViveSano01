{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle Pedido{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Pedido #{{ pedido.id }}</h2>
    <a class="btn btn-secondary" href="{% url 'lista_pedidos' %}">Volver a pedidos</a>
</div>

<p><strong>Cliente:</strong> {{ pedido.cliente_pedido }}</p>
<p><strong>Estado:</strong> {{ pedido.estado_pedido }}</p>
<p><strong>Fecha pedido:</strong> {{ pedido.fecha_creacion_pedido }}</p>
<p><strong>Fecha entrega:</strong> {{ pedido.fecha_entrega_pedido }}</p>
<p><strong>Total:</strong> {{ pedido.total_pedido }}</p>

<hr>

<div class="d-flex justify-content-between align-items-center mb-2">
    <h4>Productos del pedido</h4>
    <a class="btn btn-success" href="{% url 'agregar_detalle_pedido' pedido.id %}">
        Agregar producto
    </a>
</div>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio unitario</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for d in detalles %}
        <tr>
            <td>{{ d.producto_detalle.nombre_producto }}</td>
            <td>{{ d.cantidad_detalle }}</td>
            <td>{{ d.precio_unitario_detalle }}</td>
            <td>{{ d.subtotal }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">Este pedido aún no tiene productos.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if pedido.estado_pedido != 'CANCELADO' %}
<form method="post" action="{% url 'cancelar_pedido' pedido.id %}" class="mb-3"
    onsubmit="return confirm('¿Seguro que quieres cancelar este pedido?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">
        Cancelar pedido
    </button>
</form>
{% else %}
<p class="text-danger"><strong>Este pedido está cancelado.</strong></p>
{% endif %}

{% endblock %}